---
alwaysApply: true
---

# Infrastructure and Containers

* Work only on a remote server.
* Deploy services in Docker and manage them via `docker-compose.yml`.
* MUST use Docker Compose V2 (`docker compose`) instead of V1 (`docker-compose`). V1 is incompatible with newer Docker versions and causes `ContainerConfig` KeyError. Always use `docker compose` command (space, not hyphen).
* Do not include `version:` field in `docker-compose.yml` — Docker Compose V2 does not require it and will show a warning if present.
* Whenever possible, run commands inside containers — do not execute them on the host (exceptions: `docker`, `compose`, `curl`, `sh`, ask for additions).
* When possible, reuse base images across different containers.
* After making changes, evaluate whether a container rebuild (`build`) is required instead of just a restart (`run`).
* If the project includes periodic tasks (cron jobs), document them (with ready-to-use `crontab` syntax) for manual execution, and, if possible, automate them within a dedicated `scheduler` container.
* Making the project plan or tasks list, make sure you use database migrations.
* Do not add `Dockerfile` to the `.dockerignore`.
* If the `.env` configuration was changed OR environment variables in `docker-compose.yml` was changed, run `docker compose up -d --force-recreate --no-deps` instead of `restart`.
