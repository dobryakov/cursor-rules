# Project Constitution

## Core Principles

### Принцип I. Продуктовая ML-микросервисная архитектура

- Сервис реализуется как совокупность независимых контейнеризованных компонентов: публичное HTTP API, асинхронные воркеры расчёта, pipelines подготовки данных, ML-инфраструктура и другие.
- Все API соответствуют REST, поддерживают идемпотентность, корректные коды ответов и расширяемые контрактные схемы.

### Принцип II. Контейнеризация и открытая инфраструктура

- Все сервисы, клиенты, тестовые раннеры и вспомогательные инструменты разворачиваются через `docker-compose.yml`; на хост-машине отсутствуют обязательные зависимости.
- По умолчанию предполагается отсутствие интерпретаторов (Python, Node.js, PHP, Ruby и др.) на хост-машине; при необходимости выполнения скриптов интерпретаторы запускаются внутри соответствующих контейнеров без установки на хост.
- Используются только opensource-решения для вычислений, хранения данных, очередей, feature store и ML-life-cycle (например, FastAPI/Express, PostgreSQL, Redis, Feast, MLflow, Prefect).
- Тесты и клиентские SDK (JS, PHP, shell) находятся в отдельных контейнерах и могут запускаться автономно.

### Принцип III. Наблюдаемость и диагностируемость

- Все запросы, ошибки и фоновые задачи логируются в структурированном формате с обязательными trace id, метаданными канала, устройства и customer_id.
- Каждый ключевой сервис экспонирует health-check endpoints и метрики (latency, throughput, глубина очереди, качество рекомендаций) для мониторинга.
- Диагностические команды, docker-compose logs и скрипты предоставляются для расследования инцидентов; при добавлении функционала расширяются и логи.

### Принцип IV. Управляемая конфигурация и документация

- Все конфигурации читаются из `.env`, значение каждой переменной описано в README/справочниках; при добавлении переменных требуется пример в `env.example` и инструкция по их настройке.
- Документация и спецификации ведутся на русском языке, включают примеры curl и скриптов, описание ML-алгоритмов для бизнеса и руководства по запуску.
- Любые изменения API, конфигураций и процессов сопровождаются актуализацией README, quickstart, contracts и комментариями к миграциям.

### Принцип V. Качество, тестирование и эксперименты

- Юнит-, интеграционные и нагрузочные тесты обязательны для всех компонентов; автогенерация синтетических данных при необходимости.
- Для разных классов тестов выбираем подходящее окружение:
  - встроенные unit-тесты фреймворков запускаются в соответствующих контейнерах сервисов;
  - тесты HTTP API и браузерные (e2e, Playwright) выполняются в отдельном тестовом контейнере;
  - все тестовые контейнеры подключаются в общий `docker-compose.yml`.
  При необходимости набор контейнеров расширяется по усмотрению команды.

## Технологические стандарты

- Бэкенд API реализуется с соблюдением REST.
- Реализация клиентов (JS, PHP, shell) и вспомогательных скриптов выполняется в отдельных контейнерах; скрипты по возможности поддерживают трассировку и конфигурацию через `.env`.
- Все endpoints предоставляют примеры использования.

## Рабочий процесс и соответствие

- Перед началом работы каждая feature проходит раздел "Constitution Check" в плане; несоответствия фиксируются в таблице Complexity Tracking с обоснованием.
- Тесты запускаются в контейнерах, определённых в `docker-compose.yml`; пайплайн CI/CD использует те же образы.
- При изменении API, данных или конфигураций обязательна актуализация документации, схем контрактов и `env.example`.
- Логи и метрики исследуются через предоставленные скрипты; результаты расследований фиксируются в документации или постмортем.
- Любые сервисы, завязанные на нестандартные порты, документируются вместе с правилами проксирования через фронтенд-контейнеры.

## Governance

- Конституция обладает высшей силой: архитектурные решения, планы и код-ревью проверяются на соответствие всем принципам.
- Каждое существенное изменение сервиса сопровождается проверкой планов, спецификаций и task-листов на соблюдение принципов и технологических стандартов.

